<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Pi Network Barter Application - Final Vanilla JS UI with Pi SDK and Firebase" />
    <title>Barter-Pi Pro - Final UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .page-content { display: none; }
        .page-content.active { display: block; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        /* Custom size for very small elements, primarily mobile navigation */
        .text-2xs { font-size: 0.65rem; } 
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">

        <header class="bg-white shadow-md sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-1 sm:px-2 lg:px-4 py-1 flex flex-wrap justify-between items-center"> 

                <div class="flex items-center">
                    <img src="barter_pi_logo.png" alt="Barter Pi Logo" class="h-6 w-6 mr-1 object-contain"/> 

                    <h1 class="text-xl font-extrabold text-indigo-600 w-auto">
                        Barter-<span class="text-yellow-500">Pi</span> Pro
                    </h1>
                </div>

                <div class="text-sm text-gray-600 text-right mt-0.5 w-auto ml-auto flex items-center space-x-1">
                    <select class="bg-gray-100 p-0.5 rounded text-xs">
                        <option>üåê Hindi</option>
                        <option>üåê English</option>
                    </select>
                    <span class="font-mono text-xs bg-gray-100 p-0.5 rounded whitespace-nowrap">
                        ADM_PRO_USER_007 <span role="img" aria-label="Verified">‚úÖ</span>
                    </span>
                </div>

                <div class="flex flex-wrap justify-center sm:justify-start w-full mt-1" id="nav-buttons">
                </div>
            </div>
        </header>

        <main class="pb-10 max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 py-2">
            <section id="Home" class="page-content active space-y-3">

                <div class="bg-indigo-600 p-3 rounded-xl shadow-xl text-white flex flex-wrap justify-between items-center">
                    <div class="w-full sm:w-auto mb-1 sm:mb-0">
                        <p class="text-xs font-semibold mb-0.5">Pi Wallet Balance (Mainnet)</p>
                        <h2 class="text-3xl font-extrabold">12,456.78 <span class="text-yellow-400">Pi</span></h2>
                    </div>
                    <div class="flex flex-wrap gap-1 w-full sm:w-auto justify-end">
                        <button class="bg-indigo-500 text-white font-bold py-1.5 px-3 rounded-lg shadow-lg transition text-xs opacity-50" 
                            id="test-pi-button" 
                            disabled 
                            onclick="processTestTransaction()">
                            <span role="img" aria-label="Pay">‚è≥</span> SDK Loading...
                        </button>
                        <button class="bg-yellow-500 text-gray-900 font-bold py-1.5 px-3 rounded-lg shadow-lg hover:bg-yellow-400 transition text-xs" onclick="openModal('GcvConverter')">
                            <span role="img" aria-label="Wallet">üìà</span> GCV/Fiat
                        </button>
                    </div>
                </div>

                <div class="bg-white p-3 rounded-xl shadow-lg border border-indigo-100 space-y-2">
                    <h2 class="text-base font-bold text-gray-800">‡§≤‡•ã‡§ï‡§≤ / ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§¨‡§æ‡§∞‡•ç‡§ü‡§∞ ‡§ñ‡•ã‡§ú‡•á‡§Ç</h2>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-1">
                        <input type="text" placeholder="‡§Ü‡§á‡§ü‡§Æ ‡§Ø‡§æ ‡§ï‡•Ä‡§µ‡§∞‡•ç‡§° ‡§ñ‡•ã‡§ú‡•á‡§Ç..." class="flex-grow p-1.5 border rounded-lg text-sm" />
                        <select id="scope-filter" class="p-1.5 border rounded-lg text-sm">
                            <option value="Global">‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤</option>
                            <option value="Local">‡§≤‡•ã‡§ï‡§≤ (50km)</option>
                        </select>
                        <button class="bg-indigo-600 text-white p-1.5 rounded-lg font-semibold text-sm hover:bg-indigo-700 transition">Search</button>
                    </div>
                    <div class="h-24 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500 text-xs">
                        [Local Listing Map Placeholder]
                    </div>
                </div>

                <div class="flex space-x-2 justify-between items-center p-2 bg-white rounded-xl shadow-lg">
                    <select id="category-filter" class="p-1 border rounded-lg text-xs">
                        <option value="">‡§∏‡§≠‡•Ä ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä</option>
                        <option value="Goods">Goods (‡§∏‡§æ‡§Æ‡§æ‡§®)</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Services">Services</option>
                        <option value="NFT/Digital">NFT/Digital</option>
                    </select>
                    <select class="p-1 border rounded-lg text-xs">
                        <option>‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç: ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ</option>
                        <option>‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç: ‡§∏‡§¨‡§∏‡•á ‡§∏‡§∏‡•ç‡§§‡§æ Pi</option>
                    </select>
                     <button 
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-2.5 rounded-lg transition text-xs whitespace-nowrap"
                        onclick="openModal('NewListing')"
                    >
                        + ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
                    </button>
                </div>

                <h2 class="text-lg font-bold text-gray-800 border-b pb-1">‡§≤‡•á‡§ü‡•á‡§∏‡•ç‡§ü ‡§¨‡§æ‡§∞‡•ç‡§ü‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3" id="listings-grid">
                    <p class="col-span-4 text-center text-indigo-500 py-6">...Loading Listings from Firebase...</p>
                </div>
            </section>

            <section id="Profile" class="page-content space-y-4">
                <div class="bg-white p-6 rounded-xl shadow-xl">
                    <h2 class="text-2xl font-bold text-indigo-600 mb-4">üë§ ‡§Æ‡•á‡§∞‡§æ Pi ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤</h2>
                    <div id="login-section">
                        <div class="text-center space-y-3">
                            <p class="text-base text-gray-600">Pi Network SDK ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§≤‡•â‡§ó ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç</p>
                            <button class="bg-yellow-500 text-gray-900 font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-yellow-400 transition text-base" onclick="loginUser()">
                                <span role="img" aria-label="Pi">‚õèÔ∏è</span> Pi Login
                            </button>
                        </div>
                    </div>
                    <div id="dashboard-section" style="display: none;">
                         <div class="space-y-4">
                            <div class="flex items-center space-x-3 border-b pb-3">
                                <div class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center text-2xl font-bold text-indigo-600">P</div>
                                <div>
                                    <p class="text-xl font-bold">ADM_PRO_USER_007 <span class="text-green-500 text-base">‚úÖ KYC Verified</span></p>
                                    <p class="text-xs text-gray-600 font-mono break-all">Pi Wallet Public Key: G6Q7...X0F8</p>
                                </div>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 border-b pb-2">üìä ‡§∏‡•á‡§≤‡§∞ ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-green-50 p-3 rounded-lg shadow-sm">
                                    <p class="text-lg font-extrabold text-green-600">32,500 Pi</p>
                                    <p class="text-sm text-gray-600">‡§ï‡•Å‡§≤ ‡§Ö‡§∞‡•ç‡§ú‡§ø‡§§</p>
                                </div>
                                <div class="bg-blue-50 p-3 rounded-lg shadow-sm">
                                    <p class="text-lg font-extrabold text-blue-600">4.8/5 ‚≠ê</p>
                                    <p class="text-sm text-gray-600">‡§î‡§∏‡§§ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó</p>
                                </div>
                            </div>
                            <button class="w-full bg-indigo-500 text-white py-2 rounded-lg font-bold hover:bg-indigo-600 text-sm" onclick="alert('Generating Annual Tax Report...')">
                                <span role="img" aria-label="Report">üìë</span> ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§ü‡•ç‡§∞‡•á‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü (CSV)
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="Orders" class="page-content space-y-4">
                <h2 class="text-2xl font-bold text-indigo-600 border-b pb-2">Order ‡§î‡§∞ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó</h2>
                <div id="orders-list">
                    <p class="col-span-4 text-center text-indigo-500 py-10">...Loading Orders from Firebase...</p>
                </div>
            </section>
            <section id="Chat" class="page-content">
                 <div class="p-4 bg-white rounded-xl shadow-lg h-[600px] flex border border-gray-200">
                    <div class="flex flex-col w-full md:w-1/3 border-r pr-3 space-y-2 overflow-y-auto hidden sm:flex">
                        <h3 class="font-bold text-base text-indigo-600">‡§Æ‡•á‡§∞‡•Ä ‡§ö‡•à‡§ü‡•ç‡§∏</h3>
                        <div class="px-2 py-2 bg-indigo-100 text-indigo-700 rounded-lg font-semibold border-l-4 border-indigo-600 cursor-pointer">üí¨ iPhone 14 Pro</div>
                        <div class="px-2 py-2 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 cursor-pointer">ü§ñ AI Helper Chat</div>
                    </div>
                    <div class="flex flex-col w-full md:w-2/3 md:pl-3">
                        <h2 class="text-base font-bold text-gray-800 mb-3 border-b pb-1">iPhone 14 Pro (Chat)</h2>
                         <div class="flex-grow bg-gray-50 p-3 rounded-lg overflow-y-scroll space-y-3 text-sm" id="chat-history-container">
                            <div class="flex justify-start"><div class="bg-white p-2 rounded-xl rounded-tl-none max-w-xs shadow-md">‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§ï‡•ç‡§Ø‡§æ 400 Pi ‡§†‡•Ä‡§ï ‡§∞‡§π‡•á‡§ó‡§æ?</div></div>
                            <div class="flex justify-end"><div class="text-right"><div class="bg-indigo-100 p-2 rounded-xl rounded-tr-none max-w-xs shadow-md">450 Pi ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§π‡•à‡•§</div></div></div>
                        </div>
                        <form class="mt-3 flex space-x-2" onsubmit="handleChatSubmit(event)">
                            <input type="text" placeholder="‡§Æ‡•à‡§∏‡•á‡§ú ‡§≤‡§ø‡§ñ‡•á‡§Ç..." class="flex-grow p-2 border rounded-lg text-sm" id="chat-input"/>
                            <button type="submit" class="bg-indigo-600 text-white p-2 rounded-lg font-semibold text-sm">Send</button>
                        </form>
                    </div>
                </div>
            </section>

            <section id="AIHelper" class="page-content">
                <div class="max-w-4xl mx-auto">
                    <div class="p-4 bg-white rounded-xl shadow-lg h-[600px] flex flex-col border border-indigo-200">
                        <h2 class="text-xl font-bold text-indigo-600 mb-3 border-b pb-1">ü§ñ AI ‡§π‡•á‡§≤‡•ç‡§™‡§∞ (Gemini Pro)</h2>
                        <div class="flex-grow bg-gray-50 p-3 rounded-lg overflow-y-scroll space-y-3 mb-3 text-sm" id="ai-messages">
                            <div class="flex justify-start">
                                <div class="max-w-lg p-2 rounded-xl shadow-md bg-gray-200 text-gray-800 rounded-tl-none">
                                    ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç Barter-Pi Pro ‡§ï‡§æ **Gemini AI** ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§
                                </div>
                            </div>
                        </div>
                        <form class="flex space-x-2" id="ai-form" onsubmit="handleAIChatSubmit(event)">
                            <input type="text" placeholder="Gemini ‡§∏‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç..." class="flex-grow p-2 border rounded-lg text-sm" id="ai-input"/>
                            <button type="submit" class="bg-indigo-600 text-white p-2 rounded-lg font-semibold text-sm">Send üöÄ</button>
                        </form>
                    </div>
                </div>
            </section>

            <section id="Admin" class="page-content">
                <h2 class="text-2xl font-bold text-red-600 border-b pb-2">üö® ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h2>
                <div class="mt-4 bg-white p-4 rounded-xl shadow-lg border-l-4 border-red-600">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">‡§µ‡§ø‡§µ‡§æ‡§¶ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® (Dummy)</h3>
                    <p class="text-sm text-gray-500">‡§Ø‡§π‡§æ‡§Ç ‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§µ‡§ø‡§µ‡§æ‡§¶‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡•â‡§°‡§∞‡•á‡§ü‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§π‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</p>
                </div>
            </section>
        </main>

        <footer class="bg-white border-t p-3 text-center text-xs text-gray-500">
            Barter-Pi Pro | üîí Pi Escrow ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ | Firebase Storage Active
        </footer>

        <div id="modal-container">
            <div id="GcvConverter-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-start pt-6 p-2 hidden">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-y-auto max-h-[95vh]">
                    <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                        <h2 class="text-xl font-bold text-gray-800">üìà GCV ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§ï‡§®‡•ç‡§µ‡§∞‡•ç‡§ü‡§∞</h2>
                        <button onclick="closeModal('GcvConverter')" class="text-gray-400 hover:text-gray-600 text-2xl font-light">&times;</button>
                    </div>
                    <div class="p-4 space-y-4">
                        <div class="bg-yellow-50 p-3 rounded-lg text-sm font-medium">
                            **1 Pi = $314,159.00 USD (GCV Price)**
                            <p class="text-xs text-gray-600 mt-1">‡§Ø‡§π ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§§‡§Ø ‡§ï‡•Ä ‡§ó‡§à ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§ï‡§Ç‡§∏‡•á‡§Ç‡§∏‡§∏ ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç (GCV) ‡§π‡•à‡•§</p>
                        </div>

                        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Pi ‡§ï‡•ã INR/USD ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç</h3>

                        <label class="block text-sm font-medium text-gray-700 mb-1">Pi ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:</label>
                        <input type="number" id="pi-amount-input" value="1" min="0.01" step="0.01" class="w-full p-2 border rounded-lg text-sm focus:ring-indigo-500" oninput="updateGcvConversion()" />

                        <div class="space-y-2">
                            <div class="p-3 bg-gray-100 rounded-lg">
                                <p class="text-sm font-medium text-gray-800">GCV ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (USD) : <span id="usd-result" class="font-bold text-indigo-600">---</span></p>
                            </div>
                            <div class="p-3 bg-gray-100 rounded-lg">
                                <p class="text-sm font-medium text-gray-800">‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø (INR) : <span id="inr-result" class="font-bold text-green-600">---</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t flex justify-end">
                        <button onclick="closeModal('GcvConverter')" class="bg-gray-200 text-gray-700 font-bold py-1.5 px-3 rounded-lg text-sm">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                </div>
            </div>

            <div id="NewListing-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 justify-center items-start pt-6 p-2 hidden">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-y-auto max-h-[95vh]">
                    <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                        <h2 class="text-xl font-bold text-gray-800">‡§®‡§Ø‡§æ ‡§¨‡§æ‡§∞‡•ç‡§ü‡§∞ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h2>
                        <button onclick="closeModal('NewListing')" class="text-gray-400 hover:text-gray-600 text-2xl font-light">&times;</button>
                    </div>
                    <form id="new-listing-form" onsubmit="handleNewListingSubmit(event)" class="p-4 space-y-3">
                        <input type="text" id="listing-name" required placeholder="‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ" class="w-full p-2 border rounded-lg text-sm" />
                        <textarea id="listing-desc" required placeholder="‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£..." rows="3" class="w-full p-2 border rounded-lg text-sm"></textarea>

                        <button type="button" class="w-full bg-yellow-100 text-yellow-700 font-semibold py-2 rounded-lg text-sm hover:bg-yellow-200 transition" onclick="alert('AI Price Estimation: 150 Pi')">
                            <span role="img" aria-label="AI">üí°</span> AI ‡§∏‡•á **‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ Pi ‡§Æ‡•Ç‡§≤‡•ç‡§Ø** ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
                        </button>

                        <input type="number" id="listing-price" required placeholder="Pi ‡§Æ‡•á‡§Ç ‡§ï‡•Ä‡§Æ‡§§" step="0.01" min="0.01" class="w-full p-2 border rounded-lg text-sm" />
                        <select id="listing-category" required class="w-full p-2 border rounded-lg text-sm">
                            <option value="">--- ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç ---</option>
                            <option value="Goods">Goods (‡§∏‡§æ‡§Æ‡§æ‡§®)</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Services">Services</option>
                            <option value="Vehicles">Vehicles</option>
                            <option value="NFT/Digital">NFT/Digital</option>
                        </select>

                        <div class="border border-dashed border-gray-400 p-3 rounded-lg text-center">
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡§õ‡§µ‡§ø/‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§Ö‡§™‡§≤‡•ã‡§°</label>
                            <input type="file" multiple class="w-full text-xs text-gray-500 file:mr-3 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
                        </div>

                        <div class="flex justify-end pt-3 border-t">
                            <button type="submit" class="bg-green-600 text-white font-bold py-1.5 px-3 rounded-lg text-sm hover:bg-green-700 transition shadow-md">‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div> <script>
        // ===========================================
        // ======== START: ACTIVE JAVASCRIPT LOGIC ======
        // ===========================================

        // --- GLOBAL CONSTANTS ---
        var GCV_USD_RATE = 314159.00;
        var DUMMY_INR_RATE = 83.00; // Assuming 1 USD = 83 INR

        // --- FIREBASE CONFIGURATION (UPDATED WITH USER DATA) ---
        var firebaseConfig = {
            apiKey: "AIzaSyDFNCM6WgcClhXT8z8RPh01vHlfUpIr_H0",
            authDomain: "barterpi-new.firebaseapp.com",
            projectId: "barterpi-new",
            storageBucket: "barterpi-new.firebasestorage.app",
            messagingSenderId: "11091860587",
            appId: "1:11091860587:web:eaa398efc41db33ccae52e"
        };

        // --- GLOBAL DATA & FIREBASE INITIALIZATION ---
        var DUMMY_USER_ID = "ADM_PRO_USER_007";
        var DUMMY_ORDERS = [
            { id: 'o1', item: 'iPhone 14 Pro', pricePi: 450, status: 'Shipped', escrow: 'Active', type: 'buy', buyerId: DUMMY_USER_ID, sellerId: 'Seller_001' },
            { id: 'o2', item: 'Laptop Repair', pricePi: 35, status: 'Delivered', escrow: 'Released', type: 'sell', buyerId: 'Buyer_001', sellerId: DUMMY_USER_ID },
            { id: 'o3', item: 'Used Car', pricePi: 1500, status: 'Pending', escrow: 'Active', type: 'buy', buyerId: DUMMY_USER_ID, sellerId: 'Seller_002' },
        ];
        // DUMMY_LISTINGS ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ (No DUMMY)

        var firebaseApp;
        var db; // Firestore reference

        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            db = firebaseApp.firestore();
            console.log("Firebase initialized successfully.");
        } catch (e) {
            console.error("Firebase Initialization Error. Please check console.", e);
        }
// --- END FIREBASE SETUP ---

        // --- GCV CONVERTER LOGIC (Active) ---
        function updateGcvConversion() {
            var piInput = document.getElementById('pi-amount-input');
            var piAmount = parseFloat(piInput.value) || 0;

            var usdResult = piAmount * GCV_USD_RATE;
            var inrResult = usdResult * DUMMY_INR_RATE;

            var usdFormatted = usdResult.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });
            var inrFormatted = inrResult.toLocaleString('hi-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 2 });

            document.getElementById('usd-result').innerText = usdFormatted;
            document.getElementById('inr-result').innerText = inrFormatted;
        }

        // --- PI SDK READY CHECK & INIT (Active) ---
        function loadPiSdkScript() {
            var script = document.createElement('script');
            script.src = "https://sdk.minepi.com/sdk.js"; 
            document.head.appendChild(script);
            script.onload = checkPiReady; 
        }

        function checkPiReady() {
            var piButton = document.getElementById('test-pi-button');
            if (typeof Pi !== 'undefined') {
                try {
                    Pi.init({
                        onReady: function () {
                            piButton.removeAttribute('disabled');
                            piButton.innerText = 'üí≤ ‡§ü‡•á‡§∏‡•ç‡§ü Pi ‡§ü‡•ç‡§∞‡§æ‡§Ç‡§ú‡•á‡§ï‡•ç‡§∂‡§®'; 
                            piButton.className = piButton.className.replace('opacity-50', '');
                        }
                    });
                } catch (e) {
                    piButton.innerText = '‚ö†Ô∏è INIT ERROR'; 
                }
            } else {
                setTimeout(checkPiReady, 500); 
            }
        }

        // --- PI SDK TRANSACTION LOGIC (Active) ---
        function processTestTransaction() {
            if (typeof Pi === 'undefined') {
                alert("FAILURE: Pi SDK not found. Please ensure the app is fully reloaded in the Pi Browser.");
                return;
            }

            alert("Starting Pi Transaction. Follow the prompts in the Pi Browser to clear the developer checklist...");

            try {
                Pi.api.payments.create({
                    amount: 1, 
                    memo: "Test Transaction for Developer Checklist completion", 
                    metadata: { app: "BarterPiPro", purpose: "checklist_clear" }
                }, {
                    onReadyForServerApproval: function(paymentId) {
                        alert("SUCCESS: Transaction Ready for Server Approval! CHECKLIST CLEARED.");
                    },
                    onCancel: function(paymentId) {
                        alert("FAILURE: Transaction cancelled by user.");
                    },
                    onError: function(error) {
                        alert("ERROR: Transaction failed. Error: " + error.message);
                        console.error(error);
                    }
                });
            } catch (e) {
                alert("CRITICAL ERROR: Failed to create payment. Ensure Pi Browser permissions are correct.");
                console.error(e);
            }
        }

        // --- NEW LISTING SUBMIT HANDLER (LIVE FIREBASE ONLY) ---
        function handleNewListingSubmit(event) {
            event.preventDefault(); 

            var listingData = {
                itemName: document.getElementById('listing-name').value,
                description: document.getElementById('listing-desc').value,
                pricePi: parseFloat(document.getElementById('listing-price').value),
                category: document.getElementById('listing-category').value,
                posterId: DUMMY_USER_ID,
                status: 'Active', // ‡§°‡§æ‡§Ø‡§∞‡•á‡§ï‡•ç‡§ü 'Active' ‡§™‡§∞ ‡§∏‡•á‡§ü, ‡§è‡§°‡§Æ‡§ø‡§® ‡§Ö‡§™‡•ç‡§∞‡•Ç‡§µ‡§≤ ‡§¨‡§æ‡§Ø‡§™‡§æ‡§∏
                timestamp: new Date().toISOString() // ‡§∏‡•â‡§∞‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡§æ‡§á‡§Æ‡§∏‡•ç‡§ü‡•à‡§Æ‡•ç‡§™
            };

            // DUMMY SAVE ‡§¨‡•ç‡§≤‡•â‡§ï ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§

            // Save to Firestore (Actual logic)
            if (db) {
                db.collection("listings").add(listingData)
                    .then(function(docRef) {
                        alert('SUCCESS: ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó Firebase ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§π‡•Å‡§à! ID: ' + docRef.id);
                        document.getElementById('new-listing-form').reset();
                        closeModal('NewListing');
                        renderListings(); // Refresh list after saving
                    })
                    .catch(function(error) {
                        alert("ERROR: Firebase ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ‡•§ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§®‡§ø‡§Ø‡§Æ (Security Rules) ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§");
                        console.error("Error writing document: ", error);
                    });
            } else {
                 alert("ERROR: Firebase ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü‡•§");
            }

            return false;
        }

        // --- CHAT LOGIC (Helper Function) ---
        function addMessageToChat(containerId, sender, text) {
            var messageContainer = document.getElementById(containerId);
            var isUser = (sender === 'User');

            var messageHTML = 
                '<div class="flex ' + (isUser ? 'justify-end' : 'justify-start') + '">' +
                    '<div class="max-w-lg p-2 rounded-xl shadow-md ' + 
                        (isUser ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-gray-200 text-gray-800 rounded-tl-none') + '">' +
                        text +
                    '</div>' +
                '</div>';

            messageContainer.innerHTML += messageHTML;

            var timeout = setTimeout(function() {
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }, 100);
        }

        function handleAIChatSubmit(event) {
            event.preventDefault(); 
            var inputField = document.getElementById('ai-input');
            var userInput = inputField.value.trim();

            if (userInput === '') return;

            addMessageToChat('ai-messages', 'User', userInput);
            inputField.value = ''; 

            setTimeout(function() {
                var responseText = "Pi-‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§≠‡•Ä ‡§∏‡•Å‡§ù‡§æ‡§µ AI-‡§ú‡§®‡§∞‡•á‡§ü‡•á‡§° ‡§π‡•à‡§Ç‡•§ ‡§π‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§ü‡•ç‡§∞‡•á‡§°‡§ø‡§Ç‡§ó ‡§ó‡§æ‡§á‡§°‡•á‡§Ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Å‡§ó‡•á‡•§";

                if (userInput.toLowerCase().includes('price') || userInput.toLowerCase().includes('‡§Æ‡•Ç‡§≤‡•ç‡§Ø')) {
                    responseText = "AI Estimation: ‡§á‡§∏ ‡§Ü‡§á‡§ü‡§Æ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ Pi ‡§Æ‡•Ç‡§≤‡•ç‡§Ø 150-200 Pi ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•à‡•§";
                }

                addMessageToChat('ai-messages', 'AI', responseText);
            }, 1000); 
        }

        function handleChatSubmit(event) {
            event.preventDefault(); 
            var inputField = document.getElementById('chat-input');
            var userInput = inputField.value.trim();

            if (userInput === '') return;

            addMessageToChat('chat-history-container', 'User', userInput);
            inputField.value = ''; 

            setTimeout(function() {
                addMessageToChat('chat-history-container', 'Other', '‡§ú‡•Ä, ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤‡•§ ‡§Æ‡•à‡§Ç ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§Ü‡§™‡§ï‡•ã ‡§∂‡§ø‡§™‡§ø‡§Ç‡§ó ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§≠‡•á‡§ú‡§§‡§æ ‡§π‡•Ç‡§Å‡•§');
            }, 1500); 

            var chatContainer = document.getElementById('chat-history-container');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // --- ORDER STATUS HANDLING (Active) ---
        function handleOrderStatusChange(orderId, action) {
            if (action === 'confirm_delivery') {
                alert('SUCCESS: ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§π‡•Å‡§à! ' + orderId + ' ‡§ï‡•á ‡§≤‡§ø‡§è Escrow Pi ‡§∞‡§ø‡§≤‡•Ä‡§ú‡§º ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‡•§');
            } else if (action === 'update_tracking') {
                alert('ACTION: ' + orderId + ' ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡•ã‡§°‡§≤/‡§™‡•â‡§™-‡§Ö‡§™ ‡§ñ‡•ã‡§≤‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‡•§');
            } else if (action === 'dispute') {
                alert('DISPUTE: ' + orderId + ' ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§µ‡§æ‡§¶ ‡§¶‡§∞‡•ç‡§ú ‡§π‡•Å‡§Ü‡•§ Escrow ‡§´‡§º‡§Ç‡§° ‡§´‡§º‡•ç‡§∞‡•Ä‡§ú‡§º ‡§ï‡§ø‡§è ‡§ú‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§');
            }
            renderOrders(); 
        }

        // --- ADMIN ACTIONS (Active) ---
        function handleAdminAction(type, action, itemId) {
            if (type === 'review') {
                // DUMMY_LISTINGS ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à

                // Actual Firebase Logic:
                if (db) {
                    db.collection("listings").doc(itemId).update({ status: (action === 'approve' ? 'Active' : 'Rejected') })
                        .then(function() {
                            alert('MODERATOR: ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ' + itemId + ' ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ' + (action === 'approve' ? '‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§' : '‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§') + '‡•§');
                            switchPage('Admin'); 
                            switchPage('Home');
                        })
                        .catch(function(error) {
                            alert("ERROR: ‡§Ö‡§™‡§°‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ: " + error.message);
                        });
                } else {
                    alert('MODERATOR: Firebase ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü‡•§');
                }
            } else if (type === 'dispute_resolve') {
                alert('MODERATOR: ‡§µ‡§ø‡§µ‡§æ‡§¶ ' + itemId + ' ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§Æ‡•ã‡§°‡§≤ ‡§ñ‡•ã‡§≤‡§æ ‡§ó‡§Ø‡§æ‡•§');
            }
        }

        // --- NAVIGATION LOGIC (Active) ---
        function setupNavigation() {
            var pages = {
                'Home': '‡§π‡•ã‡§Æ', 'Profile': '‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤', 'Orders': '‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏', 
                'Chat': '‡§ö‡•à‡§ü', 'AIHelper': 'AI ‡§π‡•á‡§≤‡•ç‡§™‡§∞', 'Admin': '‡§è‡§°‡§Æ‡§ø‡§®'
            };
            var navContainer = document.getElementById('nav-buttons');
            var ADMIN_ID = DUMMY_USER_ID; 

            navContainer.innerHTML = ''; 

            for (var pageId in pages) {
                if (pageId === 'Admin' && DUMMY_USER_ID !== ADMIN_ID) continue;

                var button = document.createElement('button');
                button.innerHTML = pages[pageId];
                button.setAttribute('data-page', pageId);

                // BUTTON TEXT SIZED DOWN (text-2xs is custom size)
                button.className = 'nav-button px-1.5 py-0.5 rounded-lg text-2xs font-medium m-0.5 transition duration-200 text-gray-600 hover:bg-gray-100 whitespace-nowrap';

                button.onclick = function() { switchPage(this.getAttribute('data-page')); };
                navContainer.appendChild(button);
            }

            switchPage('Home');
        }

        function switchPage(pageId) {
            var contents = document.getElementsByClassName('page-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].className = contents[i].className.replace(' active', '');
            }

            var targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.className += ' active';
            }

            var buttons = document.getElementsByClassName('nav-button');
            for (var i = 0; i < buttons.length; i++) {
                var btn = buttons[i];
                btn.className = btn.className.replace(' bg-indigo-600 text-white shadow-lg', '');
                if (btn.getAttribute('data-page') === pageId) {
                    btn.className += ' bg-indigo-600 text-white shadow-lg';
                }
            }

            // Render content based on page
            if (pageId === 'Orders') { renderOrders(); }
            if (pageId === 'Home') { renderListings(); }
            if (pageId === 'Admin') { renderAdmin(); }
        }

        // --- MODAL LOGIC (Active) ---
        function openModal(modalId) {
            var modal = document.getElementById(modalId + '-modal');
            if (modal) {
                if (modalId === 'GcvConverter') {
                    updateGcvConversion(); 
                }
                modal.style.display = 'flex';
            }
        }
        function closeModal(modalId) {
            var modal = document.getElementById(modalId + '-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // --- LOGIN LOGIC (Active) ---
        function loginUser() {
            alert('Pi Network Login SDK call simulated. Logging in...');
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('dashboard-section').style.display = 'block';
        }
        // --- LISTING RENDERING (LIVE FIREBASE ONLY) ---
        function renderListings() {
            var grid = document.getElementById('listings-grid');
            var categoryFilter = document.getElementById('category-filter').value;
            grid.innerHTML = '<p class="col-span-4 text-center text-indigo-500 py-6">...Loading Listings from Firebase...</p>';

            if (!db) {
                grid.innerHTML = '<p class="col-span-4 text-center text-red-500 py-6">Error: Firebase ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ‡•§</p>';
                return;
            }

            // 1. ‡§è‡§ï ‡§¨‡•á‡§∏ ‡§ï‡•ç‡§µ‡•á‡§∞‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç
            var query = db.collection("listings")
                          .where("status", "==", "Active")
                          .orderBy("timestamp", "desc"); // ‡§®‡§è ‡§Ü‡§á‡§ü‡§Æ ‡§∏‡§¨‡§∏‡•á ‡§ä‡§™‡§∞

            // 2. ‡§Ö‡§ó‡§∞ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§≤‡§ó‡§æ ‡§π‡•à, ‡§§‡•ã ‡§â‡§∏‡•á ‡§ï‡•ç‡§µ‡•á‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            if (categoryFilter) {
                query = query.where("category", "==", categoryFilter);
            }

            // 3. Firebase ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§Æ‡§Ç‡§ó‡§µ‡§æ‡§è‡§Ç
            query.get()
                .then(function(querySnapshot) {
                    var html = '';
                    if (querySnapshot.empty) {
                        grid.innerHTML = '<p class="col-span-4 text-center text-gray-500 py-6">‡§ï‡•ã‡§à ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§</p>';
                        return;
                    }

                    // 4. ‡§π‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è HTML ‡§ï‡§æ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç
                    querySnapshot.forEach(function(doc) {
                        var listing = doc.data();
                        var docId = doc.id;
                        var statusClass = 'bg-green-100 text-green-700'; // Active status
                        var itemImageText = listing.itemName.replace(/ /g, '+');

                        html += '<div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hover:shadow-2xl hover:cursor-pointer transition duration-300 transform hover:scale-[1.02]" onclick="alert(\'Viewing details for ' + listing.itemName + ' (ID: ' + docId + ')\')">';
                        html += '<img src="https://via.placeholder.com/400x300?text=' + itemImageText + '" alt="' + listing.itemName + '" class="w-full h-36 object-cover" />';
                        html += '<div class="p-3">';
                        html += '<h3 class="text-base font-bold text-gray-800 mb-1 h-10 overflow-hidden">' + listing.itemName + '</h3>';
                        html += '<div class="flex justify-between items-center mb-2">';
                        html += '<div class="text-xl font-extrabold text-indigo-600">' + listing.pricePi + ' Pi</div>';
                        html += '<span class="px-2 py-0.5 text-2xs font-medium rounded-full ' + statusClass + '">Active</span>';
                        html += '</div>';
                        html += '<button class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-1.5 rounded-lg text-sm transition">‚ÑπÔ∏è ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>';
                        html += '</div></div>';
                    });
                    
                    grid.innerHTML = html; // 5. ‡§ó‡•ç‡§∞‡§ø‡§° ‡§Æ‡•á‡§Ç HTML ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
                })
                .catch(function(error) {
                    console.error("Firebase ‡§∏‡•á ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§≤‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞: ", error);
                    grid.innerHTML = '<p class="col-span-4 text-center text-red-500 py-6">‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞ ‡§Ü‡§Ø‡§æ‡•§</p>';
                });
        }


        // --- ORDER RENDERING (DUMMY ONLY) ---
        function renderOrders() {
            var listContainer = document.getElementById('orders-list');
            var html = '<h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">üì¶ ‡§Æ‡•á‡§∞‡•á ‡§∏‡§≠‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞‡•ç‡§∏</h3>';

            if (DUMMY_ORDERS.length === 0) {
                listContainer.innerHTML = '<p class="text-center py-8 text-gray-500">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>';
                return;
            }

            DUMMY_ORDERS.forEach(function(order) {
                var orderId = order.id;
                var statusClass = order.status === 'Delivered' ? 'bg-green-500 text-white' : 'bg-yellow-500 text-gray-900';
                var escrowStatus = order.escrow === 'Active' ? 'üîí Escrow Active' : '‚úÖ Pi Released';
                var isBuying = (order.buyerId === DUMMY_USER_ID); 
                var typeClass = isBuying ? 'bg-blue-50' : 'bg-green-50';

                html += '<div class="mb-3 p-3 border rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center ' + typeClass + '">';
                html += '<div>';
                html += '<p class="font-semibold text-base">' + order.item + ' <span class="text-xs font-medium text-gray-500">(' + (isBuying ? '‡§ñ‡§∞‡•Ä‡§¶' : '‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä') + ')</span></p>';
                html += '<p class="text-sm text-gray-500">‡§ï‡•Ä‡§Æ‡§§: **' + order.pricePi + ' Pi** | Escrow: ' + escrowStatus + '</p>';
                html += '</div>';
                html += '<div class="text-right mt-1 sm:mt-0">';
                html += '<span class="px-2 py-0.5 text-xs font-bold rounded-full block ' + statusClass + '">' + order.status + '</span>';

                if (isBuying && order.status === 'Shipped') {
                    html += '<button onclick="handleOrderStatusChange(\'' + orderId + '\', \'confirm_delivery\')" class="mt-1 text-green-600 text-xs hover:underline block font-semibold">‚úÖ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç</button>';
                    html += '<button onclick="handleOrderStatusChange(\'' + orderId + '\', \'dispute\')" class="mt-1 text-red-600 text-xs hover:underline block font-semibold">‚ùì ‡§µ‡§ø‡§µ‡§æ‡§¶ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</button>';
                } else if (!isBuying && order.status === 'Shipped') {
                    html += '<button onclick="handleOrderStatusChange(\'' + orderId + '\', \'update_tracking\')" class="bg-indigo-600 text-white py-1 px-2 rounded-lg text-xs font-semibold mt-1">‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>';
                }

                html += '</div></div>';
            });
            listContainer.innerHTML = html;
        }


        // --- ADMIN PAGE RENDERING (DUMMY ONLY) ---
        function renderAdmin() {
            var adminContainer = document.getElementById('Admin');
            // DUMMY_LISTINGS ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è Admin ‡§∞‡§ø‡§µ‡•ç‡§Ø‡•Ç ‡§™‡•á‡§ú ‡§ñ‡§æ‡§≤‡•Ä ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ ‡§ú‡§¨ ‡§§‡§ï ‡§π‡§Æ ‡§á‡§∏‡•á Firebase ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§§‡•á
            var pendingListings = []; 

            var reviewHtml = '<div class="bg-white p-5 rounded-xl shadow-lg border-l-4 border-yellow-600"><h3 class="text-lg font-semibold text-gray-800 mb-3 border-b pb-2">‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ (' + pendingListings.length + ')</h3><ul class="space-y-2">';

            if (pendingListings.length === 0) {
                reviewHtml += '<li class="text-gray-500 text-sm">‡§ï‡•ã‡§à ‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§®‡§π‡•Ä‡§Ç‡•§</li>';
            } else {
                // ‡§Ø‡§π ‡§∏‡•á‡§ï‡•ç‡§∂‡§® Firebase ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§® ‡§π‡•ã‡§®‡•á ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡•á‡§ó‡§æ‡•§
            }
            reviewHtml += '</ul></div>';

            var disputeHtml = '<div class="mt-6 bg-white p-5 rounded-xl shadow-lg border-l-4 border-red-600"><h3 class="text-lg font-semibold text-gray-800 mb-3 border-b pb-2">‡§µ‡§ø‡§µ‡§æ‡§¶ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® (Dummy)</h3><p class="text-xs text-gray-500">‡§Ø‡§π‡§æ‡§Ç ‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§µ‡§ø‡§µ‡§æ‡§¶‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡•â‡§°‡§∞‡•á‡§ü‡§∞ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§π‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§</p></div>';

            adminContainer.innerHTML = reviewHtml + disputeHtml;
        }

        // --- INITIALIZATION (Final Fix) ---
        window.onload = function() {
            setupNavigation();

            var categoryFilter = document.getElementById('category-filter');
            if (categoryFilter) {
                categoryFilter.addEventListener('change', renderListings);
            }

            renderListings(); 
            loadPiSdkScript(); 
        };
    </script>
</body>
</html>
